<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crustdata Support Chatbot</title>
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
      <div class="chat-box">
          <div class="chat-header">
              Crustdata API Support Chat
          </div>
          <div id="chat-log" class="chat-log"></div>
          <div class="chat-input">
              <input id="user-input" type="text" placeholder="Ask a question..." />
              <button id="send-button" onclick="sendMessage()">Send</button>
          </div>
      </div>
      <script>
          const faq = {
              "What is the Crustdata API rate limit?": "The Crustdata API rate limit is 1000 requests per minute.",
              "How can I authenticate with the Crustdata API?": "You can authenticate using an API key. Simply pass it as a bearer token in the request header.",
              "What are the supported file formats for data upload?": "The Crustdata API supports CSV, JSON, and Parquet formats for data uploads."
          };

          const backendUrl = 'https://crustdata-backend-6f6dd1115e03.herokuapp.com'; // Define your backend URL here

          async function sendMessage() {
              const userInput = document.getElementById("user-input").value.trim();
              if (!userInput) return;

              const chatLog = document.getElementById("chat-log");
              chatLog.innerHTML += `<div class='chat-message user-message'>You: ${userInput}</div>`;
              document.getElementById("user-input").value = "";
              console.log("Backend URL: ", backendUrl);
              try {
                  const response = await fetch(`${backendUrl}/chat`, {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify({ message: userInput })
                  });
                  const data = await response.json();
                  chatLog.innerHTML += `<div class='chat-message bot-message'>Bot: ${data.answer}</div>`;
              } catch (error) {
                  chatLog.innerHTML += `<div class='chat-message bot-message'>Bot: An error occurred. Please try again later.</div>`;
              }

              chatLog.scrollTop = chatLog.scrollHeight; // Auto-scroll to the bottom
          }
      </script>
  </body>
</html>